psize = 32;
Lmax = 2;
c = 1;

if (Lmax == 2)
    isize = 16*16;
elseif (Lmax == 3)
    isize = 46*46;
else
    isize = 106*106;
end

Vmin = 0; Vmax = 1;

options = gaoptimset('PopulationSize',psize,...
                     'PopInitRange',[Vmin;Vmax],...
                     'InitialPopulation',[],...
                     'InitialScores',[],...
                     'EliteCount',psize/8,...
                     'Generations',1e5,...
                     'StallGenLimit',Inf,...
                     'TolFun',0,...
                     'CrossoverFcn',@crossoverintermediate,...
                     'MutationFcn',{@mutationgaussian 1.0 0.0},...
                     'OutputFcns',@gasave,...
                     'UseParallel','never',...
                     'PlotFcns',@gaplotbestf);

[x,f,exitFlag,output,population,scores] = ga(@(x)HT_MA(x,network,c,Lmax),isize,[],[],[],[],[],[],[],options); 

figure; imagesc(reshape(x,[sqrt(isize) sqrt(isize)])); colormap(gray);